<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é«˜å´é§… ARæ¡ˆå†…ã‚·ã‚¹ãƒ†ãƒ ï¼ˆè¤‡æ•°ãƒ«ãƒ¼ãƒˆå¯¾å¿œï¼‰</title>
<style>
  body { margin: 0; overflow: hidden; font-family: "Segoe UI", sans-serif; color: white; text-align: center; }
  video#camera, #bgImage { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; object-fit: cover; z-index: 0; }
  #bgImage { background: url("https://upload.wikimedia.org/wikipedia/commons/3/3f/Takasaki_Station_concourse.jpg") center/cover; opacity: 0.35; z-index: 1; }
  #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 2; pointer-events: none; }
  #arrow { font-size: 100px; animation: pulse 1.2s infinite; }
  @keyframes pulse { 0%{opacity:0.7; transform:scale(1);} 50%{opacity:1; transform:scale(1.2);} 100%{opacity:0.7; transform:scale(1);} }
  #textBox { background: rgba(0,0,0,0.6); padding: 10px 20px; border-radius: 10px; font-size: 20px; margin-top: 10px; }
  #menu { position: fixed; top: 10px; left: 50%; transform: translateX(-50%); z-index: 3; background: rgba(30,30,30,0.8); padding: 10px; border-radius: 10px; display: flex; gap: 8px; align-items: center; }
  button { background: #2196f3; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; }
  button:hover { background: #0b7dda; }
</style>
</head>
<body>

<video id="camera" autoplay playsinline muted></video>
<div id="bgImage"></div>

<div id="menu">
  <select id="routeSelect">
    <option value="">ãƒ«ãƒ¼ãƒˆã‚’é¸æŠ</option>
    <option value="7ç•ªç·šâ†’ä¸Šä¿¡é›»é‰„">åœ¨æ¥ç·š7ç•ªç·š â†’ ä¸Šä¿¡é›»é‰„</option>
    <option value="æ–°å¹¹ç·šæ”¹æœ­â†’æ±å£">æ–°å¹¹ç·šæ”¹æœ­ â†’ æ±å£</option>
    <option value="æ±å£â†’é«˜å´OPA">æ±å£ â†’ é«˜å´OPA</option>
  </select>
  <button onclick="startRoute()">æ¡ˆå†…é–‹å§‹</button>
  <button onclick="resetRoute()">ãƒªã‚»ãƒƒãƒˆ</button>
</div>

<div id="overlay">
  <div id="arrow">ğŸ—ºï¸</div>
  <div id="textBox">ãƒ«ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</div>
</div>

<script>
// ğŸ¯ è¤‡æ•°ãƒ«ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆç·¯åº¦ãƒ»çµŒåº¦ã¯é«˜å´é§…ä»˜è¿‘ã®ä»®ãƒ‡ãƒ¼ã‚¿ï¼‰
const routes = {
  "7ç•ªç·šâ†’ä¸Šä¿¡é›»é‰„": [
    { text: "åœ¨æ¥ç·š7ç•ªç·šãƒ›ãƒ¼ãƒ ã‚’å‡ºç™º", arrow: "â¬†ï¸", lat: 36.3215, lon: 139.0122 },
    { text: "ã‚³ãƒ³ã‚³ãƒ¼ã‚¹ã‚’å·¦ã¸", arrow: "â¬…ï¸", lat: 36.3217, lon: 139.0124 },
    { text: "ä¸Šä¿¡é›»é‰„æ”¹æœ­ã¸é€²ã‚€", arrow: "â¬†ï¸", lat: 36.3219, lon: 139.0126 },
    { text: "ä¸Šä¿¡é›»é‰„æ”¹æœ­ã«åˆ°ç€ï¼", arrow: "âœ…", lat: 36.3221, lon: 139.0128 }
  ],
  "æ–°å¹¹ç·šæ”¹æœ­â†’æ±å£": [
    { text: "æ–°å¹¹ç·šæ”¹æœ­å‰ã‚’å‡ºç™º", arrow: "â¬†ï¸", lat: 36.3212, lon: 139.0120 },
    { text: "å³æ–¹å‘ã«é€²ã‚€", arrow: "â¡ï¸", lat: 36.3214, lon: 139.0123 },
    { text: "æ±å£éšæ®µã‚’é™ã‚Šã‚‹", arrow: "â¬‡ï¸", lat: 36.3216, lon: 139.0125 },
    { text: "æ±å£å‡ºå£ã«åˆ°ç€ï¼", arrow: "âœ…", lat: 36.3218, lon: 139.0127 }
  ],
  "æ±å£â†’é«˜å´OPA": [
    { text: "æ±å£ãƒ­ãƒ¼ã‚¿ãƒªãƒ¼ã‚’å‡ºç™º", arrow: "â¬†ï¸", lat: 36.3218, lon: 139.0127 },
    { text: "æ¨ªæ–­æ­©é“ã‚’æ¸¡ã‚‹", arrow: "â¡ï¸", lat: 36.3219, lon: 139.0130 },
    { text: "é«˜å´OPAæ­£é¢å…¥å£ã«é€²ã‚€", arrow: "â¬†ï¸", lat: 36.3220, lon: 139.0133 },
    { text: "OPAå…¥å£ã«åˆ°ç€ï¼", arrow: "âœ…", lat: 36.3222, lon: 139.0135 }
  ]
};

let currentRoute = [];
let currentStep = 0;

// ğŸ“· ã‚«ãƒ¡ãƒ©èµ·å‹•
(async () => {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: { ideal: "environment" } }
    });
    document.getElementById("camera").srcObject = stream;
  } catch (e) {
    alert("ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã§ãã¾ã›ã‚“: " + e.message);
  }
})();

// ğŸ“ è·é›¢è¨ˆç®—ï¼ˆHaversineå¼ï¼‰
function distance(lat1, lon1, lat2, lon2) {
  const R = 6371e3; // åœ°çƒã®åŠå¾„[m]
  const toRad = (x) => x * Math.PI / 180;
  const Ï†1 = toRad(lat1);
  const Ï†2 = toRad(lat2);
  const Î”Ï† = toRad(lat2 - lat1);
  const Î”Î» = toRad(lon2 - lon1);
  const a = Math.sin(Î”Ï†/2)**2 + Math.cos(Ï†1)*Math.cos(Ï†2)*Math.sin(Î”Î»/2)**2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}

// ğŸ“± GPSç›£è¦–
function startGPS() {
  if (!navigator.geolocation) {
    alert("GPSã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚");
    return;
  }

  navigator.geolocation.watchPosition(pos => {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;

    const stepData = currentRoute[currentStep];
    const d = distance(lat, lon, stepData.lat, stepData.lon);

    document.getElementById("textBox").textContent =
      `${stepData.text}ï¼ˆç´„${d.toFixed(1)}må…ˆï¼‰`;
    document.getElementById("arrow").textContent = stepData.arrow;

    if (d < 10 && currentStep < currentRoute.length - 1) {
      currentStep++;
      showStep();
    } else if (d < 10 && currentStep === currentRoute.length - 1) {
      document.getElementById("textBox").textContent = "ç›®çš„åœ°ã«åˆ°ç€ã—ã¾ã—ãŸï¼";
      document.getElementById("arrow").textContent = "ğŸ‰";
    }

  }, err => {
    alert("ä½ç½®æƒ…å ±ã‚¨ãƒ©ãƒ¼: " + err.message);
  }, { enableHighAccuracy: true, maximumAge: 1000 });
}

// ğŸ§­ ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤º
function showStep() {
  const s = currentRoute[currentStep];
  document.getElementById("arrow").textContent = s.arrow;
  document.getElementById("textBox").textContent = s.text;
}

// ğŸš€ æ¡ˆå†…é–‹å§‹
function startRoute() {
  const name = document.getElementById("routeSelect").value;
  if (!name) return alert("ãƒ«ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
  currentRoute = routes[name];
  currentStep = 0;
  showStep();
  startGPS();
}

// ğŸ”„ ãƒªã‚»ãƒƒãƒˆ
function resetRoute() {
  currentRoute = [];
  currentStep = 0;
  document.getElementById("arrow").textContent = "ğŸ—ºï¸";
  document.getElementById("textBox").textContent = "ãƒ«ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„";
}
</script>

</body>
</html>
